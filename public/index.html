<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auction System Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #000;
      color: #fff;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      padding: 40px 0;
      border-bottom: 1px solid #333;
    }

    h1 {
      font-size: 32px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #888;
      font-size: 14px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 40px;
    }

    .card {
      background: #111;
      border: 1px solid #222;
      padding: 30px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .card:hover {
      border-color: #fff;
      transform: translateY(-2px);
    }

    .card h2 {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .card p {
      color: #888;
      font-size: 14px;
      line-height: 1.5;
    }

    .panel {
      display: none;
      margin-top: 40px;
      background: #111;
      border: 1px solid #222;
      padding: 40px;
    }

    .panel.active {
      display: block;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: #888;
    }

    input, textarea, select {
      width: 100%;
      padding: 12px;
      background: #000;
      border: 1px solid #333;
      color: #fff;
      font-size: 14px;
      font-family: inherit;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #fff;
    }

    button {
      padding: 12px 24px;
      background: #fff;
      color: #000;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s;
    }

    button:hover {
      background: #ddd;
    }

    button:disabled {
      background: #333;
      color: #666;
      cursor: not-allowed;
    }

    .response {
      margin-top: 20px;
      padding: 20px;
      background: #000;
      border: 1px solid #333;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
    }

    .success {
      border-color: #0f0;
      color: #0f0;
    }

    .error {
      border-color: #f00;
      color: #f00;
    }

    .back-btn {
      background: #222;
      color: #fff;
      margin-bottom: 20px;
    }

    .back-btn:hover {
      background: #333;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .stat {
      background: #000;
      border: 1px solid #333;
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .stat-label {
      color: #888;
      font-size: 12px;
    }

    .table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }

    .table th,
    .table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #222;
    }

    .table th {
      color: #888;
      font-weight: 600;
      font-size: 12px;
    }

    .table td {
      font-size: 14px;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      background: #222;
      font-size: 11px;
      border-radius: 2px;
    }

    .badge.active {
      background: #0f0;
      color: #000;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Auction System</h1>
      <p class="subtitle">Backend API Testing Interface</p>
    </header>

    <div id="main-menu" class="grid">
      <div class="card" onclick="showPanel('auth')">
        <h2>Authentication</h2>
        <p>Register and login to get access token</p>
      </div>

      <div class="card" onclick="showPanel('auctions')">
        <h2>Auctions</h2>
        <p>Create and manage multi-round auctions</p>
      </div>

      <div class="card" onclick="showPanel('bids')">
        <h2>Bidding</h2>
        <p>Place and increase bids in active auctions</p>
      </div>

      <div class="card" onclick="showPanel('simulator')">
        <h2>Simulator</h2>
        <p>Run automated auction simulation with bots</p>
      </div>

      <div class="card" onclick="window.open('/api-docs', '_blank')">
        <h2>API Documentation</h2>
        <p>View complete API documentation</p>
      </div>

      <div class="card" onclick="showPanel('stats')">
        <h2>System Stats</h2>
        <p>View real-time system statistics</p>
      </div>
    </div>

    <!-- Auth Panel -->
    <div id="auth" class="panel">
      <button class="back-btn" onclick="showMenu()">Back</button>
      <h2>Authentication</h2>

      <div class="form-group">
        <label>Username</label>
        <input type="text" id="auth-username" placeholder="username">
      </div>

      <div class="form-group">
        <label>Password</label>
        <input type="password" id="auth-password" placeholder="password">
      </div>

      <div class="form-group">
        <label>Email (optional for register)</label>
        <input type="email" id="auth-email" placeholder="email@example.com">
      </div>

      <button onclick="register()">Register</button>
      <button onclick="login()" style="margin-left: 10px;">Login</button>

      <div id="auth-response"></div>
    </div>

    <!-- Auctions Panel -->
    <div id="auctions" class="panel">
      <button class="back-btn" onclick="showMenu()">Back</button>
      <h2>Auctions</h2>

      <button onclick="loadAuctions()">Load Auctions</button>
      <button onclick="showCreateAuction()" style="margin-left: 10px;">Create New</button>

      <div id="create-auction" style="display: none; margin-top: 20px;">
        <div class="form-group">
          <label>Name</label>
          <input type="text" id="auction-name" placeholder="Premium NFT Collection">
        </div>

        <div class="form-group">
          <label>Total Items</label>
          <input type="number" id="auction-items" value="200">
        </div>

        <div class="form-group">
          <label>Items Per Round</label>
          <input type="number" id="auction-items-round" value="50">
        </div>

        <div class="form-group">
          <label>Round Duration (seconds)</label>
          <input type="number" id="auction-duration" value="600">
        </div>

        <div class="form-group">
          <label>Min Bid</label>
          <input type="number" id="auction-minbid" value="100">
        </div>

        <div class="form-group">
          <label>Min Bid Step (%)</label>
          <input type="number" id="auction-step" value="5">
        </div>

        <button onclick="createAuction()">Create Auction</button>
      </div>

      <div id="auctions-response"></div>
    </div>

    <!-- Bids Panel -->
    <div id="bids" class="panel">
      <button class="back-btn" onclick="showMenu()">Back</button>
      <h2>Bidding</h2>

      <div class="form-group">
        <label>Auction ID</label>
        <input type="text" id="bid-auction-id" placeholder="Paste auction ID">
      </div>

      <div class="form-group">
        <label>Bid Amount</label>
        <input type="number" id="bid-amount" placeholder="500">
      </div>

      <button onclick="placeBid()">Place Bid</button>
      <button onclick="getMyBids()" style="margin-left: 10px;">My Bids</button>

      <div id="bids-response"></div>
    </div>

    <!-- Simulator Panel -->
    <div id="simulator" class="panel">
      <button class="back-btn" onclick="showMenu()">Back</button>
      <h2>Auction Simulator</h2>

      <div class="form-group">
        <label>Number of Bots</label>
        <input type="number" id="sim-bots" value="10">
      </div>

      <div class="form-group">
        <label>Bid Frequency (ms)</label>
        <input type="number" id="sim-frequency" value="2000">
      </div>

      <button onclick="startSimulation()">Start Simulation</button>
      <button onclick="stopSimulation()" style="margin-left: 10px;">Stop</button>

      <div id="simulator-response"></div>
    </div>

    <!-- Stats Panel -->
    <div id="stats" class="panel">
      <button class="back-btn" onclick="showMenu()">Back</button>
      <h2>System Statistics</h2>

      <button onclick="loadStats()">Refresh Stats</button>

      <div id="stats-response"></div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/api';
    let token = localStorage.getItem('token') || '';
    let simulationInterval = null;

    function showPanel(panelId) {
      document.getElementById('main-menu').style.display = 'none';
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.getElementById(panelId).classList.add('active');
    }

    function showMenu() {
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.getElementById('main-menu').style.display = 'grid';
    }

    function showResponse(elementId, data, isError = false) {
      const el = document.getElementById(elementId);
      el.innerHTML = `<div class="response ${isError ? 'error' : 'success'}">${JSON.stringify(data, null, 2)}</div>`;
    }

    async function apiCall(endpoint, method = 'GET', body = null) {
      const options = {
        method,
        headers: {
          'Content-Type': 'application/json',
        },
      };

      if (token) {
        options.headers['Authorization'] = `Bearer ${token}`;
      }

      if (body) {
        options.body = JSON.stringify(body);
      }

      const response = await fetch(`${API_URL}${endpoint}`, options);
      const data = await response.json();

      if (!response.ok) {
        throw data;
      }

      return data;
    }

    async function register() {
      try {
        const data = await apiCall('/auth/register', 'POST', {
          username: document.getElementById('auth-username').value,
          password: document.getElementById('auth-password').value,
          email: document.getElementById('auth-email').value || undefined,
        });

        token = data.token;
        localStorage.setItem('token', token);
        showResponse('auth-response', data);
      } catch (error) {
        showResponse('auth-response', error, true);
      }
    }

    async function login() {
      try {
        const data = await apiCall('/auth/login', 'POST', {
          username: document.getElementById('auth-username').value,
          password: document.getElementById('auth-password').value,
        });

        token = data.token;
        localStorage.setItem('token', token);
        showResponse('auth-response', data);
      } catch (error) {
        showResponse('auth-response', error, true);
      }
    }

    function showCreateAuction() {
      document.getElementById('create-auction').style.display = 'block';
    }

    async function createAuction() {
      try {
        const now = new Date();
        now.setMinutes(now.getMinutes() + 2);

        const data = await apiCall('/auctions', 'POST', {
          name: document.getElementById('auction-name').value,
          totalItems: parseInt(document.getElementById('auction-items').value),
          itemsPerRound: parseInt(document.getElementById('auction-items-round').value),
          startTime: now.toISOString(),
          roundDuration: parseInt(document.getElementById('auction-duration').value),
          antiSnipeWindow: 60,
          antiSnipeExtension: 60,
          minBid: parseInt(document.getElementById('auction-minbid').value),
          minBidStep: parseInt(document.getElementById('auction-step').value),
          currency: 'STARS',
        });

        showResponse('auctions-response', data);
      } catch (error) {
        showResponse('auctions-response', error, true);
      }
    }

    async function loadAuctions() {
      try {
        const data = await apiCall('/auctions');
        
        let html = '<table class="table"><thead><tr><th>Name</th><th>Items</th><th>Status</th><th>Rounds</th><th>Actions</th></tr></thead><tbody>';
        
        data.data.forEach(auction => {
          html += `
            <tr>
              <td>${auction.name}</td>
              <td>${auction.totalItems}</td>
              <td><span class="badge ${auction.status === 'active' ? 'active' : ''}">${auction.status}</span></td>
              <td>${auction.currentRound}/${auction.totalRounds}</td>
              <td><button onclick="viewAuction('${auction._id}')">View</button></td>
            </tr>
          `;
        });
        
        html += '</tbody></table>';
        document.getElementById('auctions-response').innerHTML = html;
      } catch (error) {
        showResponse('auctions-response', error, true);
      }
    }

    async function placeBid() {
      try {
        const data = await apiCall('/bids', 'POST', {
          auctionId: document.getElementById('bid-auction-id').value,
          amount: parseInt(document.getElementById('bid-amount').value),
        });

        showResponse('bids-response', data);
      } catch (error) {
        showResponse('bids-response', error, true);
      }
    }

    async function getMyBids() {
      try {
        const data = await apiCall('/bids/my-bids');
        showResponse('bids-response', data);
      } catch (error) {
        showResponse('bids-response', error, true);
      }
    }

    async function startSimulation() {
      const bots = parseInt(document.getElementById('sim-bots').value);
      const frequency = parseInt(document.getElementById('sim-frequency').value);

      document.getElementById('simulator-response').innerHTML = '<div class="loading">Simulation running...</div>';

      // Create bot users
      const botUsers = [];
      for (let i = 0; i < bots; i++) {
        try {
          const bot = await apiCall('/auth/register', 'POST', {
            username: `bot_${Date.now()}_${i}`,
            password: 'botpass123',
          });
          botUsers.push(bot);
        } catch (e) {
          console.error('Bot creation failed:', e);
        }
      }

      // Get active auctions
      const auctions = await apiCall('/auctions?status=active');
      if (!auctions.data.length) {
        showResponse('simulator-response', { error: 'No active auctions' }, true);
        return;
      }

      const auctionId = auctions.data[0]._id;

      // Start bidding
      let bidCount = 0;
      simulationInterval = setInterval(async () => {
        const randomBot = botUsers[Math.floor(Math.random() * botUsers.length)];
        const amount = Math.floor(Math.random() * 500) + 100;

        try {
          await fetch(`${API_URL}/bids`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${randomBot.token}`,
            },
            body: JSON.stringify({ auctionId, amount }),
          });

          bidCount++;
          document.getElementById('simulator-response').innerHTML = 
            `<div class="stats">
              <div class="stat">
                <div class="stat-value">${botUsers.length}</div>
                <div class="stat-label">Active Bots</div>
              </div>
              <div class="stat">
                <div class="stat-value">${bidCount}</div>
                <div class="stat-label">Total Bids</div>
              </div>
            </div>`;
        } catch (e) {
          console.error('Bid failed:', e);
        }
      }, frequency);
    }

    function stopSimulation() {
      if (simulationInterval) {
        clearInterval(simulationInterval);
        simulationInterval = null;
        showResponse('simulator-response', { message: 'Simulation stopped' });
      }
    }

    async function loadStats() {
      try {
        const auctions = await apiCall('/auctions');
        
        document.getElementById('stats-response').innerHTML = 
          `<div class="stats">
            <div class="stat">
              <div class="stat-value">${auctions.data.length}</div>
              <div class="stat-label">Total Auctions</div>
            </div>
            <div class="stat">
              <div class="stat-value">${auctions.data.filter(a => a.status === 'active').length}</div>
              <div class="stat-label">Active Auctions</div>
            </div>
          </div>`;
      } catch (error) {
        showResponse('stats-response', error, true);
      }
    }
  </script>
</body>
</html>